## Code Generation Prompt for Hierarchical Heterogeneous GNN:

```md
I need you to implement a hierarchical heterogeneous graph neural network for multi-omics cancer subtyping following the exact project structure below. Implement each component according to its designated location in the file hierarchy.
### PROJECT STRUCTURE TO FOLLOW:
HierarchicalHeteroGNN/
├── config/
│   ├── base_config.py           # Base configuration classes
│   ├── model_config.py          # Model hyperparameters and architecture settings
│   └── data_config.py           # Data paths and preprocessing parameters
├── data/mappings/               # CSV mapping files (pre-provided)
│   ├── methylation_to_genes.csv # CpG site → gene mapping
│   ├── mirna_to_genes.csv       # miRNA → target gene mapping  
│   └── ensembl_mappings.csv     # Ensembl ID mappings
├── src/
│   ├── data/
│   │   ├── data_loader.py       # Load multi-omics data (mRNA, CNV, methylation, miRNA)
│   │   ├── feature_extractor.py # Handle CtAE pre-extracted features
│   │   ├── mapping_utils.py     # Process CSV mapping files
│   │   └── pathway_loader.py    # Load KEGG/Reactome/cBioPortal pathways
│   ├── graphs/
│   │   ├── level1/
│   │   │   ├── patient_graph_builder.py    # Build patient-specific heterogeneous graphs
│   │   │   ├── omics_nodes.py              # Define 4 omics node types with features
│   │   │   └── intra_patient_edges.py      # Create edges: mRNA↔CNV, methylation→genes, miRNA→genes
│   │   ├── level2/
│   │   │   ├── inter_patient_builder.py    # Build inter-patient pathway network
│   │   │   ├── pathway_edges.py            # Connect patients via shared pathway alterations  
│   │   │   └── alteration_edges.py         # Connect patients via gene-specific alterations
│   │   └── graph_utils.py                  # Common graph utilities and validation
│   ├── models/
│   │   ├── layers/
│   │   │   ├── hetero_gat_layer.py         # Heterogeneous GAT implementation
│   │   │   ├── attention_mechanisms.py     # Multi-level attention for hierarchy
│   │   │   └── message_passing.py          # Custom message passing between levels
│   │   ├── level1_model.py                 # Patient-level graph encoder
│   │   ├── level2_model.py                 # Inter-patient network encoder  
│   │   ├── hierarchical_model.py           # Combined hierarchical architecture
│   │   └── base_model.py                   # Abstract base classes
│   ├── training/
│   │   ├── trainer.py                      # Main training loop and optimization
│   │   ├── loss_functions.py               # Cancer subtyping loss functions
│   │   └── metrics.py                      # Evaluation metrics (accuracy, AUC, etc.)
│   └── utils/
│       ├── logging_utils.py                # Logging and monitoring
│       ├── visualization.py                # Graph and attention visualization
│       └── reproducibility.py             # Random seed management
├── scripts/
│   ├── train_model.py                      # Main training script
│   ├── evaluate_model.py                   # Model evaluation script  
│   └── preprocess_data.py                  # Data preprocessing pipeline

### IMPLEMENTATION REQUIREMENTS BY MODULE:
1. Configuration System (config/)
Implement configuration classes that manage:

base_config.py: Abstract base configuration with common parameters
model_config.py: HeteroGAT architecture settings, attention heads, hidden dimensions
data_config.py: Dataset paths, preprocessing parameters, mapping file locations

2. Data Infrastructure (src/data/)
data_loader.py should implement:

Multi-omics data loading for TCGA/METABRIC datasets
Support for mRNA, CNV, DNA methylation, miRNA modalities
Integration with pre-extracted CtAE features as node attributes

mapping_utils.py should implement:

CSV mapping file processors for:

methylation_to_genes.csv: CpG site genomic coordinates → nearest TSS genes
mirna_to_genes.csv: miRNA IDs → target gene predictions (TargetScan + miRTarBase)
ensembl_mappings.csv: Ensembl gene ID mappings for mRNA↔CNV connections


pathway_loader.py should implement:

KEGG pathway data integration
Reactome pathway database loading
cBioPortal alteration annotations (amplified, deleted, mutated, overexpressed)

3. Level 1 Graph Construction (src/graphs/level1/)
patient_graph_builder.py should implement:

PatientGraphBuilder class that creates heterogeneous graphs per patient
Node Types: 4 omics modalities (mRNA, CNV, methylation, miRNA)
Node Features: CtAE-extracted features as node attributes
Integration with PyTorch Geometric HeteroData format

intra_patient_edges.py should implement:

mRNA ↔ CNV edges: Direct Ensembl gene ID matching
DNA methylation → Gene edges: Use methylation_to_genes.csv mapping
miRNA → Gene edges: Use mirna_to_genes.csv mapping
Edge weight calculation based on correlation/biological significance

4. Level 2 Graph Construction (src/graphs/level2/)
inter_patient_builder.py should implement:

InterPatientNetworkBuilder class
Nodes: Each patient from Level 1 becomes a node in Level 2
Patient similarity calculation and network construction

pathway_edges.py should implement:

Connect patients through shared pathway alterations
Weight edges by frequency of shared pathway involvement
Use pathway significance scores

alteration_edges.py should implement:

Connect patients through specific gene alterations
Handle CNA amplifications, deletions, mutations, overexpression patterns
Calculate similarity based on alteration profiles

5. Model Architecture (src/models/)
hierarchical_model.py should implement:

HierarchicalHeteroGAT main model class
Level 1 Processing: Patient-specific heterogeneous graph encoding
Level 2 Processing: Inter-patient pathway network encoding
Output: Patient-level cancer subtype predictions

layers/hetero_gat_layer.py should implement:

Heterogeneous Graph Attention Network layers
Relation-specific attention mechanisms for different edge types
Support for both Level 1 (omics integration) and Level 2 (patient connections)

layers/attention_mechanisms.py should implement:

Multi-level attention for hierarchical structure
Intra-patient attention: Focus on important omics relationships
Inter-patient attention: Identify significant pathway connections
Interpretable attention weights for biological analysis

6. Training Pipeline (src/training/)
trainer.py should implement:

CancerSubtypingTrainer class with hierarchical model training
Support for both Level 1 and Level 2 loss computation
Gradient flow through hierarchical architecture
Proper train/validation/test splits for cancer datasets

loss_functions.py should implement:

Cancer subtyping-specific loss functions
Multi-level loss combination (Level 1 + Level 2)
Class imbalance handling for cancer subtypes

metrics.py should implement:

Cancer subtyping evaluation metrics
Accuracy, precision, recall, F1-score, AUC-ROC
Pathway-level importance scoring
Biomarker identification metrics

7. Main Scripts (scripts/)
train_model.py should implement:

Main training script that orchestrates the entire pipeline
Configuration loading and model initialization
Training loop execution with proper logging
Model checkpointing and evaluation

preprocess_data.py should implement:

Complete data preprocessing pipeline
CtAE feature extraction coordination
Mapping file validation and processing
Dataset preparation for training

### TECHNICAL SPECIFICATIONS:
Dependencies to Use:
```python
import torch
import torch.nn as nn
import torch_geometric
from torch_geometric.data import HeteroData, DataLoader
from torch_geometric.nn import HetGATConv, to_hetero
import pandas as pd
import numpy as np
import networkx as nx
```
Key Classes to Implement:

HierarchicalHeteroGAT: Main model combining both levels
PatientGraphBuilder: Level 1 graph construction
InterPatientNetworkBuilder: Level 2 network construction
MultiLevelAttention: Hierarchical attention mechanism
CancerSubtypingTrainer: Training coordination

Critical Implementation Details:

Use exact CSV mapping files as specified in data/mappings/
Implement proper heterogeneous graph handling with PyTorch Geometric
Support GPU acceleration with CUDA
Include comprehensive error handling and input validation
Maintain biological interpretability through attention visualization
Follow the exact file structure and module organization provided

Expected Outputs:

Patient-level cancer subtype predictions
Pathway-level importance scores
Gene-level biomarker identification
Interpretable attention weights for clinical relevance
Visualization of both graph levels and attention patterns

Start implementation with the configuration system and data loading utilities, then proceed through graph construction to model architecture. Each file should be self-contained but properly integrated with the overall system architecture.
```